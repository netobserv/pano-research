version: '3'

networks:
  pano-network:
    driver: bridge

services:
  netobserv-ebpf-agent:
    image:  quay.io/enahum/netobserv-ebpf-agent:main
    container_name: netobserv-ebpf-agent
    networks:
      - pano-network
    ports:
      - 57102:57102
    restart: always
    environment:
      - FLOWS_TARGET_PORT=57102
      - FLOWS_TARGET_HOST=127.0.0.1
      - ENABLE_PANO=true

  zeek:
    image: "zeek:v5.0.7"
    container_name: zeek
    depends_on: 
      - kafka
    networks:
      - pano-network
    volumes:
     - ./zeek/logs/:/usr/local/zeek/logs:rw
    command: /usr/local/zeek/bin/zeek -D -B all -C -e 'redef LogAscii::use_json = T;' -i pcapovertcp::netobserv-ebpf-agent:57102  /usr/local/zeek/share/zeek/site/local.zeek

  kafka:
    image: 'bitnami/kafka:latest'
    container_name: kafka
    networks:
      - pano-network
    ports:
      - 9092:9092
      - 9093:9093
    environment:
      - ALLOW_PLAINTEXT_LISTENER=yes
        
  flowlogs-pipeline:
    image: flowlogs-pipeline-pano:latest
    container_name: flowlogs-pipeline
    depends_on: 
      - kafka
    ports:
      - 9102:9102
    networks:
      - pano-network
    command:
      - --config=/app/pano-kafka-dns.yaml
